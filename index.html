<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.0.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon-32x32-next.ico">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.ico">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="personal blog of cc">
<meta property="og:type" content="website">
<meta property="og:title" content="starC">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="starC">
<meta property="og:description" content="personal blog of cc">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="chen cong">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://example.com/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>starC</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">starC</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">一路同行</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签<span class="badge">7</span></a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">11</span></a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/02/21/Self-attention/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="chen cong">
      <meta itemprop="description" content="personal blog of cc">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="starC">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/02/21/Self-attention/" class="post-title-link" itemprop="url">Self-attention</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2022-02-21 10:06:16 / 修改时间：11:14:23" itemprop="dateCreated datePublished" datetime="2022-02-21T10:06:16+08:00">2022-02-21</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="一、Vector-Set-as-Input"><a href="#一、Vector-Set-as-Input" class="headerlink" title="一、Vector Set as Input"></a>一、Vector Set as Input</h1><p>​        与以前遇到的问题不同，输入的是一个向量的集合。向量的数目不确定。</p>
<p>​        典型应用：NLP中语句作为输入，每个单词是一个vector，可以用one-hot编码编成向量，也可以用word-embedding包含语义信息；语音输入，以frame为单位，一定步长移动；Social-network，可以将每个节点作为一个vector；高分子结构，同样可以视为一种graph。</p>
<h1 id="二、The-output"><a href="#二、The-output" class="headerlink" title="二、The output"></a>二、The output</h1><p>1.each vector has a label</p>
<p>例子：</p>
<ul>
<li>词性标注 I saw a saw.  –&gt;&gt; N V DET N</li>
<li>social networrk每个节点的特性</li>
</ul>
<p>2.the whole sequence has a label</p>
<p>例子:</p>
<ul>
<li>sentiment analysis</li>
<li>预测高分子的性质</li>
</ul>
<p>3.Model decides the number of labels tself</p>
<p>例子:</p>
<ul>
<li>翻译</li>
<li>语音辨识</li>
</ul>
<h1 id="三、Type-one"><a href="#三、Type-one" class="headerlink" title="三、Type one"></a>三、Type one</h1><p>sequence label问题</p>
<p>1.self-attention作为解决方法</p>
<p><img src="/2022/02/21/Self-attention/1.png" alt="1"></p>
<p>不是考虑一个frame或windows，而是考虑整个sequence作为输入</p>
<p>同时self-attention可以多次使用且可以与fully-conntected network交替使用</p>
<p><img src="/2022/02/21/Self-attention/2.png" alt="2"></p>
<p>2.self-attention做法</p>
<p>计算一对vector之间的关联程度</p>
<p><img src="/2022/02/21/Self-attention/3.png" alt="3"></p>
<p>计算sequence中vector的关联程度</p>
<p><img src="/2022/02/21/Self-attention/4.png" alt="4"></p>
<p>最终输出一个vector</p>
<p><img src="/2022/02/21/Self-attention/5.png" alt="5"></p>
<p>简化运算形式：</p>
<p><img src="/2022/02/21/Self-attention/6.png" alt="6"></p>
<p><img src="/2022/02/21/Self-attention/7.png" alt="7"></p>
<p><img src="/2022/02/21/Self-attention/8.png" alt="8"></p>
<p>3.multi-head attention</p>
<p>发掘不同的self-attention</p>
<p><img src="/2022/02/21/Self-attention/9.png" alt="9"></p>
<p>4.Positional Encoding</p>
<p>上述计算中并没有考虑位置信息，计算过程对称。</p>
<p>但如果认为位置信息比较重要则可以加进去，做法可以对每一个位置生成一个unique vector，与原来的输入相加即可。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/02/13/%E5%B0%8F%E6%A0%B7%E6%9C%AC%E5%AD%A6%E4%B9%A0%E8%AE%BA%E6%96%87%E5%A4%8D%E7%8E%B0%E4%B9%8BDMF/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="chen cong">
      <meta itemprop="description" content="personal blog of cc">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="starC">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/02/13/%E5%B0%8F%E6%A0%B7%E6%9C%AC%E5%AD%A6%E4%B9%A0%E8%AE%BA%E6%96%87%E5%A4%8D%E7%8E%B0%E4%B9%8BDMF/" class="post-title-link" itemprop="url">小样本学习论文复现之DMF</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2022-02-13 10:52:02 / 修改时间：10:57:29" itemprop="dateCreated datePublished" datetime="2022-02-13T10:52:02+08:00">2022-02-13</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="1月22日"><a href="#1月22日" class="headerlink" title="1月22日"></a>1月22日</h1><p>1.看了工程代码框架，可以从以下几个模块去实现：</p>
<ul>
<li>命令行参数获取与解析</li>
<li>数据集处理Datasets</li>
<li>数据加载器DataLoader</li>
<li>网络架构，网络按照论文分为Resnet提取特征、连接Support Image和Query Image做动态采样、用Dynamic Meta-filter提取与空间、通道相关的特征、用Neural ODE做特征匹配、定义损失函数训练Meta-Classifier与global Classifier</li>
</ul>
<p>自己复现的话很多参数都可以固定下来</p>
<p>2.学习了部分参数解析和DataLoader的语法</p>
<p>3.构思工程</p>
<p>如上有四个模块，功能集成在top.py中完成；需要为参数获取定义一个类，需要为Datasets与DataLoader定义两个类，需要搭建网络结构且由于小样本的特殊性，test与训练用的循环不能共用</p>
<p>4.开写</p>
<h1 id="1月29日更新"><a href="#1月29日更新" class="headerlink" title="1月29日更新"></a>1月29日更新</h1><p>前几天学习了一下pytorch语法，也摸了几天鱼，半写半抄算是把dataLoader弄出来了。</p>
<p><img src="/2022/02/13/%E5%B0%8F%E6%A0%B7%E6%9C%AC%E5%AD%A6%E4%B9%A0%E8%AE%BA%E6%96%87%E5%A4%8D%E7%8E%B0%E4%B9%8BDMF/DMF%E5%A4%8D%E7%8E%B0-1.jpg" alt="DMF复现-1"></p>
<p>现在是完成了参数获取与数据加载。</p>
<p>再看了一遍论文，准备对照official code再搞搞剩余的训练与</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/02/13/%E8%AE%BA%E6%96%87%E5%AD%A6%E4%B9%A0-DMF/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="chen cong">
      <meta itemprop="description" content="personal blog of cc">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="starC">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/02/13/%E8%AE%BA%E6%96%87%E5%AD%A6%E4%B9%A0-DMF/" class="post-title-link" itemprop="url">论文学习-DMF</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2022-02-13 10:51:45 / 修改时间：11:06:56" itemprop="dateCreated datePublished" datetime="2022-02-13T10:51:45+08:00">2022-02-13</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="一、关于Few-shot-Learning"><a href="#一、关于Few-shot-Learning" class="headerlink" title="一、关于Few-shot Learning"></a>一、关于Few-shot Learning</h1><p>​        Few-shot Learning与Meta-learning相似，可以视为其的一种应用，但又有区别。在图像分类领域：Few-shot Learning的目的是根据已知给定的extremly limited examples，学习到知识并用来识别新的类别。</p>
<p>​        最naive的想法是用深度卷积神经网络学习到support set中类别的一些特征，在query set做预测时直接比较特征间的相似性，但是直接使用卷积学到的特征受限很于数据，对于没有见过的类别很难泛化其分类能力。需要进一步增加模型特征提取与匹配的能力。</p>
<h1 id="二、Learning-Dynamic-Alignment-via-Meta-filter-for-Few-shot-Learning的思想"><a href="#二、Learning-Dynamic-Alignment-via-Meta-filter-for-Few-shot-Learning的思想" class="headerlink" title="二、Learning Dynamic Alignment via Meta-filter for Few-shot Learning的思想"></a>二、Learning Dynamic Alignment via Meta-filter for Few-shot Learning的思想</h1><h4 id="1-前人的工作"><a href="#1-前人的工作" class="headerlink" title="1.前人的工作"></a>1.前人的工作</h4><p>​        参考CAN和FEAT这两篇论文。它们的思想是aggregates support knowledge to formalize an alignment function for query samples以此达到特征匹配的目的(没看过这两篇，咱也不懂)。</p>
<p>​        作者认为存在一些缺陷：</p>
<ul>
<li><p>Roughness，作者认为图像特征的空间位置的差异性(空间分辨率spaial resolution)比通道间的差异性大得多而很少有工作在提取特征是关注channel 相关特征。</p>
<p>如下图，特征应该是黄色区域，channel1提现得很好而channel2较差。CAN做特征匹配时会赋予两个通道相同的权重，而DMF不会</p>
<p><img src="/2022/02/13/%E8%AE%BA%E6%96%87%E5%AD%A6%E4%B9%A0-DMF/DMF-2.png" alt="DMF-2"></p>
</li>
<li><p>Redundant matching. 冗余主要出现在两个地方，一个是待识别的物体可能在一张图像中多次出现；其次是当 aligning each query position时，会利用所有的support feature，效率较低(不是很懂,大受震撼)。</p>
</li>
<li><p>Inflexible alignment. The alignment strategy in these works only runs one time for all tasks. Thus, for those diffificult ones, the alignment may be insuffificient to appropriately embed the support knowledge into query feature.</p>
</li>
</ul>
<h2 id="2-作者的方法"><a href="#2-作者的方法" class="headerlink" title="2.作者的方法"></a>2.作者的方法</h2><ul>
<li>Dynamic meta-filter. 用于高效特征匹配</li>
<li>Dynamic sample and group strategy.提升Dynamic meta-filter的灵活性与效率。</li>
<li>Neural ODE. </li>
</ul>
<p>预测一个和空间位置、通道相关的Dynamic meta-filter，将filters应用于feature positions而不是整个support feature。Features positions不是采取的固定的而是学习得到动态采样策略。同时为了使匹配能适用于更复杂的任务而固定超参数很难控制匹配的过程、程度，所以采用ODE的方法执行residual alignment的过程并在迭代过程中自适应地调整步长以获得最终解。</p>
<p>在获取到aligned query feature后，将support knowledge以不可学习方式聚合在一起，利用mata-slassifier做最终的预测。</p>
<h2 id="3-相关工作"><a href="#3-相关工作" class="headerlink" title="3.相关工作"></a>3.相关工作</h2><h5 id="1-Few-shot-recognition"><a href="#1-Few-shot-recognition" class="headerlink" title="1.Few-shot recognition."></a>1.Few-shot recognition.</h5><p>目前两种主流解决策略: 一种是optimization-based methods.首先根据base class data训练一个网络，再在遇到未见过的类别、数据时微调网络或者改变整个网络架构。第二种是metric-based method，应用现成的或者学习到的图像特征做FSL。</p>
<h5 id="2-Dynamic-Sampling"><a href="#2-Dynamic-Sampling" class="headerlink" title="2.Dynamic Sampling"></a>2.Dynamic Sampling</h5><p>以前的采样方法：固定大小采样，动态区域采样但是滤波器大小固定。</p>
<p>作者：先用动态采样策略获取feature position的邻域再再这个区域上预测得到与位置和通道相关的滤波器。</p>
<h5 id="3-Input-dependent-weights"><a href="#3-Input-dependent-weights" class="headerlink" title="3.Input dependent weights"></a>3.Input dependent weights</h5><p>也是learnable module的一种体现，weights不是直接优化得到而是与输入数据相关。</p>
<h5 id="4-Neural-Ordinary-Difference-Equation"><a href="#4-Neural-Ordinary-Difference-Equation" class="headerlink" title="4.Neural Ordinary Difference Equation"></a>4.Neural Ordinary Difference Equation</h5><p>Neural ODE将神经网络的前递视作ODE的一种离散形式(???为什么是离散的？因为网络架构是固定的吗？)。在此情况下，可以加入一个时间变量控制输出以使得修改neural networks为neural ODE。</p>
<h1 id="三、DMF架构与操作"><a href="#三、DMF架构与操作" class="headerlink" title="三、DMF架构与操作"></a>三、DMF架构与操作</h1><h5 id="1-DMF架构"><a href="#1-DMF架构" class="headerlink" title="1.DMF架构"></a>1.DMF架构</h5><p><img src="/2022/02/13/%E8%AE%BA%E6%96%87%E5%AD%A6%E4%B9%A0-DMF/DMF-3.png" alt="DMF-3"></p>
<p>包含四个子模块：特征提取器f<sub>emb</sub>,动态匹配模块f<sub>d</sub>,  meta-classifier f<sub>mc</sub>,  global-classifier f<sub>gc</sub>. 在一次Episode中，给定每对support image和query image，首先利用特征提取器提取得到大小为[c, h, w]的feature maps，对应channel,height和width；再动态采样获取特征；用f<sub>d</sub>进行特征的动态匹配；最后用f<sub>mc</sub>根据query feature与support feature之间的相似性输出confidence score.</p>
<h5 id="2-DMF-Dynamic-Meta-filter-for-Adaptive-Alignment"><a href="#2-DMF-Dynamic-Meta-filter-for-Adaptive-Alignment" class="headerlink" title="2.DMF(Dynamic Meta-filter for Adaptive Alignment)"></a>2.DMF(Dynamic Meta-filter for Adaptive Alignment)</h5><p>关于分组卷积：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/shine-lee/p/10243114.html">Group Convolution分组卷积，以及Depthwise Convolution和Global Depthwise Convolution - shine-lee - 博客园 (cnblogs.com)</a></p>
<p><img src="/2022/02/13/%E8%AE%BA%E6%96%87%E5%AD%A6%E4%B9%A0-DMF/DMF-4.png" alt="DMF-4"></p>
<p><img src="/2022/02/13/%E8%AE%BA%E6%96%87%E5%AD%A6%E4%B9%A0-DMF/DMF-5.png" alt="DMF-5"></p>
<p>对support feature先做一次卷积，卷积核大小为3，输出通道为c x K x K，可以视为图像每个位置的像素对应一个c x K x K大小的张量，再将其视为该位置一个输出通道为c，核大小为K的卷积核。对query feature的每个位置使用对应的卷积核进行group为3的<strong>分组卷积</strong>，与原本的query feature相加得到aligned query feature. </p>
<p>值得注意：channel wise正是通过分组卷积实现的。每个K x K的卷积核对应于原query maps中的一张query feature。</p>
<h5 id="3-Dynamic-Sampling"><a href="#3-Dynamic-Sampling" class="headerlink" title="3.Dynamic Sampling"></a>3.Dynamic Sampling</h5><p><img src="/2022/02/13/%E8%AE%BA%E6%96%87%E5%AD%A6%E4%B9%A0-DMF/DMF-6.png" alt="DMF-6"></p>
<p><img src="/2022/02/13/%E8%AE%BA%E6%96%87%E5%AD%A6%E4%B9%A0-DMF/DMF-7.png" alt="DMF-7"></p>
<p>先将support feature与query feature拼接在一起，用核大小为5，通道为9的卷积核进行卷积，生成一张9 x h x w的feature mapM。M的每个位置的9个数值包含生成在位置(i,j)的卷积核的信息。</p>
<h5 id="4-Adaptive-Alignment"><a href="#4-Adaptive-Alignment" class="headerlink" title="4.Adaptive Alignment"></a>4.Adaptive Alignment</h5><p>重复匹配过程</p>
<p><img src="/2022/02/13/%E8%AE%BA%E6%96%87%E5%AD%A6%E4%B9%A0-DMF/DMF-8.png" alt="DMF-8"></p>
<p>F是前面的动态卷积的过程。问题是超参数T的调整，对于FSL，面对不同的任务，超参数T应该不同，所以作者使用了Neural ODE的方法。</p>
<p><img src="/2022/02/13/%E8%AE%BA%E6%96%87%E5%AD%A6%E4%B9%A0-DMF/DMF-9.png" alt="DMF-9"></p>
<h5 id="5-Meta-classifier"><a href="#5-Meta-classifier" class="headerlink" title="5.Meta classifier"></a>5.Meta classifier</h5><p>获取Dynamically aligned query feature后，不需要任何可学习参数生成一个meta-classifier。方法：使用glaobal averge pooling将support feature聚集到一个c x 1 x 1的feature上，将这个c x 1 x 1的张量作为一个卷积滤波器，也即架构中的f<sub>mc</sub>，并运用在aligned上可以得到一个1 x h x w的张量。如果query set中某张图属于category c,则它们对应位置应该有很高数值。</p>
<h1 id="四、实现细节"><a href="#四、实现细节" class="headerlink" title="四、实现细节"></a>四、实现细节</h1><h5 id="1-损失函数"><a href="#1-损失函数" class="headerlink" title="1.损失函数"></a>1.损失函数</h5><p><img src="/2022/02/13/%E8%AE%BA%E6%96%87%E5%AD%A6%E4%B9%A0-DMF/DMF-10.png" alt="DMF-10"></p>
<h5 id="2-网络架构"><a href="#2-网络架构" class="headerlink" title="2.网络架构"></a>2.网络架构</h5><p>使用ResNet12去除最后的池化层用于特征提取，feature map</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/02/13/Meta-learning%E5%AD%A6%E4%B9%A0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="chen cong">
      <meta itemprop="description" content="personal blog of cc">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="starC">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/02/13/Meta-learning%E5%AD%A6%E4%B9%A0/" class="post-title-link" itemprop="url">Meta-learning学习</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2022-02-13 10:51:32 / 修改时间：11:05:46" itemprop="dateCreated datePublished" datetime="2022-02-13T10:51:32+08:00">2022-02-13</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="一、与ML的比较"><a href="#一、与ML的比较" class="headerlink" title="一、与ML的比较"></a>一、与ML的比较</h1><p>​        可以从目标、步骤等方面进行比较。</p>
<p>​        Machine Learning的目的是寻找一个函数解决某个任务，通过一轮轮迭代更新模型参数以达到目的。常规步骤：定义一个含有未知参数的模型、定义模型的损失函数、根据损失函数使用优化器迭代模型。</p>
<p>​        Meta Learning则是指learning about learning。目的是使机器具有学习的能力，通过在任务A、B、C上的学习，能迅速掌握解决任务D的方法。具体的，根据李宏毅老师的课程：我们相当于要学习到一种Learning algorithm，以分类任务为例，我们可以输入二分类任务，如分类苹果和香蕉、太阳和月亮的任务，通过训练掌握Learning algorithm后可以很快解决猫猫和狗狗的分类问题。也有三个步骤：先决定what is learnable?典型的learnable component有网络框架、初始化参数、学习率等；随后定义损失函数；第三步依旧是优化器优化learnable component。在训练过程中每轮迭代解决一个训练任务，任务具有训练数据与测试数据，在训练数据上训练，损失函数定义在训练任务的测试数据上以评估该任务上训练出模型的好坏。最终meta-learning会在测试任务上进行测试，根据表现判断learnable component是否被学到了。</p>
<h1 id="二、一些术语"><a href="#二、一些术语" class="headerlink" title="二、一些术语"></a>二、一些术语</h1><p>​        每轮训练的输入是一个training tasks, training tasks的数据分为Support set和Query set，分别用于该任务的训练和测试。一次训练成为一个Episode。</p>
<h1 id="三、损失函数"><a href="#三、损失函数" class="headerlink" title="三、损失函数"></a>三、损失函数</h1><p><img src="/2022/02/13/Meta-learning%E5%AD%A6%E4%B9%A0/Meta-learning-1.png" alt="Meta-learning-1"></p>
<p>采用批量数据训练，Machine Learning的Loss是累和一个batch中所有example的预测值与Label之间的误差；</p>
<p>Meta Learning是一个Batch中所有task上面Loss的累和</p>
<h1 id="四、Learnable-component"><a href="#四、Learnable-component" class="headerlink" title="四、Learnable component"></a>四、Learnable component</h1><h5 id="1-Learning-to-initialize"><a href="#1-Learning-to-initialize" class="headerlink" title="1.Learning to initialize"></a>1.Learning to initialize</h5><p>经典论文Model-Agnostic Meta-Learning(MAML)</p>
<p>Reptile: <a target="_blank" rel="noopener" href="https://arxiv.org/abs/1803.02999">https://arxiv.org/abs/1803.02999</a></p>
<p>How to train your MAML?</p>
<h5 id="2-Optimizer"><a href="#2-Optimizer" class="headerlink" title="2.Optimizer"></a>2.Optimizer</h5><h5 id="3-Network-Architecture-Search-NAS"><a href="#3-Network-Architecture-Search-NAS" class="headerlink" title="3.Network Architecture Search(NAS)"></a>3.Network Architecture Search(NAS)</h5><p>……</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/02/13/CG-Raterizing/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="chen cong">
      <meta itemprop="description" content="personal blog of cc">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="starC">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/02/13/CG-Raterizing/" class="post-title-link" itemprop="url">CG_Raterizing</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2022-02-13 10:30:54 / 修改时间：10:31:15" itemprop="dateCreated datePublished" datetime="2022-02-13T10:30:54+08:00">2022-02-13</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>如何判断一个点是否在三角形内部？</p>
<p>做叉积，做三次叉积即可判断</p>
<p>反走样、可见性</p>
<p>光栅化后会产生锯齿？如何抗锯齿或反走样？</p>
<p>Aliasing，我们需要做反走样 Anti-Aliasing</p>
<p>Jaggies空间、位置采样的问题</p>
<p>Moire</p>
<p>Wagon wheel effect</p>
<p>本质是：信号变化太快以至于采样速度无法跟上</p>
<p>可以先模糊再光栅化</p>
<p>傅里叶级数与傅里叶变换</p>
<p>傅里叶级数用</p>
<p>图像频率与采样频率</p>
<p>滤波：滤掉特定频率的波</p>
<p>傅里叶变换：时域–&gt;&gt;频率</p>
<p>Filtering == Concolution == Averaging</p>
<p>卷积定理</p>
<p>时域上两个信号的卷积等价于频域上两个信号的乘积</p>
<p>如何做卷积？</p>
<ul>
<li>在时域(spatial domain)上直接卷积</li>
<li>傅里叶变换到频域(frequency domain),在频域上做乘积，再逆傅里叶变换转化会时域</li>
</ul>
<p>更大的卷积核对应更小的频域</p>
<p>Sampling=Repeating Frequency Contents</p>
<p>冲击函数时域到频域的转换–&gt;&gt;复制原始信号</p>
<p>如果采样函数频率太低，冲击函数距离不远，信号混叠。</p>
<p>Reduce Aliasing Error:</p>
<p>1.提高采样频率</p>
<p>2.先模糊再采样</p>
<p>对原始信号先进行处理，减小信号宽度，再以原始的间隔去复制的时候，不再产生信号的混叠</p>
<p>对每一个像素空间进行卷积求平均</p>
<p>MSAA:</p>
<p>Multi-sample anti-aliasing</p>
<p>将大像素划分为小像素，判断小像素是否再三角形内部。根据小像素在三角形内的覆盖率得到像素值</p>
<p>但是考虑到成本问题，工业界使用不规则的小像素分布，其中部分小像素还会被相邻区域复用</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/02/13/CG-Shading/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="chen cong">
      <meta itemprop="description" content="personal blog of cc">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="starC">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/02/13/CG-Shading/" class="post-title-link" itemprop="url">CG_Shading</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2022-02-13 10:29:52 / 修改时间：10:30:23" itemprop="dateCreated datePublished" datetime="2022-02-13T10:29:52+08:00">2022-02-13</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Visubility可见性问题"><a href="#Visubility可见性问题" class="headerlink" title="Visubility可见性问题"></a>Visubility可见性问题</h1><p>需要解决物体绘制在屏幕上的先后顺序</p>
<p>Painter’s Algirithm:先绘制远处物体，再逐渐把近处物体堆叠上去遮挡远处的物体</p>
<p>但是难以解决相互遮挡的问题。因为空间中的遮挡关系不是一个偏序关系，不满足传递性。</p>
<p>引入深度缓存z-buffer的概念</p>
<p>转换思路，从对物体排序到对像素排序，每次记录每个像素最浅位置的几何体</p>
<ul>
<li>frame buffer stores color values</li>
<li>depth buffer stores depth</li>
</ul>
<p>算法：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (each triangle T)</span><br><span class="line">	<span class="keyword">for</span> (each sample (x, y, z) in T)</span><br><span class="line">		<span class="keyword">if</span>(z &lt; zbuffer[x, y])</span><br><span class="line">			framebuffer[x, y] = rgb</span><br><span class="line">			zbuffer[x,y] = z</span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">			<span class="keyword">do</span> nothing</span><br></pre></td></tr></table></figure>

<p>Question:</p>
<ul>
<li><p>两个几何体有深度完全相同的点？</p>
</li>
<li><p>与MSAA的结合，不是对每个像素做z-buffer而是对每个采样点</p>
</li>
<li><p>透明物体不能用z-buffer</p>
</li>
</ul>
<h1 id="About-Shadding"><a href="#About-Shadding" class="headerlink" title="About Shadding"></a>About Shadding</h1><p>定义：        </p>
<p>​        noun. The darkening or coloring of an illustration or diagram with parallel lines or a block of color.</p>
<p>​        The process of applying a matetial to an object.</p>
<p>着色与光照、与材料的关系</p>
<p>Simple Shading Model(Blin-Phong Reflectance Model)</p>
<p>Specular highlights, Diffuse reflection, Ambient lighting</p>
<p>三种光的区别是什么？如何描述？</p>
<p>考虑一个shading point，假设其邻域是一个极小的平面，从而可以定义</p>
<ul>
<li>View direction</li>
<li>Surface normal</li>
<li>Light direction</li>
<li>Suraface parameters….</li>
</ul>
<p>需要注意，shading not equals shadow。着色不考虑其他物体的存在，只考虑这个点自己，所以shading具有局部性。</p>
<p>Diffuse Reflection:</p>
<p>考虑单位面积接收到的能量，余弦定理易得。</p>
<p>Light off: 光的能量传播认为以球壳形状传播，光的能量应该与据光源的距离的平方成反比</p>
<p>能量接收与反射，看到的光是因为物体表面反射光，所以亮度与光的吸收率有关。</p>
<p>漫反射往四面八方反射的光的强度应该与观测角度无关</p>
<p>Specular Term：</p>
<p>观察方向与镜面反射方向相同或接近时，看到高光。</p>
<p>巧妙的变换：镜面反射方向与观测方向的角度等于法向方向与half vector的角度</p>
<p>强度是一个指数关系–高光往往只局限于很小的区域</p>
<p>Ambient Term</p>
<p>接收环境中的光</p>
<p>假设：每个点接收的环境光的强度都是相同的。环境光来源是四面八方，与光的源头无关，与观测的角度无关，与shading point的法向无关，所以是一个常数。</p>
<p>但是上述假设较为粗糙，经过了很大的简化。</p>
<p>L  = L<sub>a</sub> + L<sub>d</sub> + L<sub>s</sub> </p>
<p>​    = Ambient Term + Disfussion Term + Specular Term</p>
<p>但是Blin-Phong模型是一个很简化的模型</p>
<p>关于Shading Frequencies</p>
<p>Flat shading.三角形取三个点，确定一个平面，平面内色素值相同</p>
<p>Gouraud shading:对顶点上取点做shading，内部差值</p>
<p>Phong shading:对每个像素做shading</p>
<p>问题：</p>
<p>逐顶点的法线：用该顶点相邻面法向的平均，是否需要根据相邻面的大小进行加权平均？</p>
<p>已经知道顶点法线，如何得到内部点平滑的法线方向？</p>
<p>给顶点差值得到（利用重心公式）</p>
<h1 id="Graphics-Real-time-Rendering-Pipeline-图形管线"><a href="#Graphics-Real-time-Rendering-Pipeline-图形管线" class="headerlink" title="Graphics(Real-time Rendering) Pipeline(图形管线)"></a>Graphics(Real-time Rendering) Pipeline(图形管线)</h1><p>1.含义：一些列操作，从三维空间中的点到图像</p>
<p>Input: vertices in 3D space –&gt;&gt; Vertices positioned in screen space –&gt;&gt; Triangles  positioned in screen space –&gt;&gt; Fragments –&gt;&gt; Shaded fragments –&gt;&gt; Output: image</p>
<p>2.open-GL的shader program example</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">uniform sampler2D myTexture;</span><br><span class="line">uniform vec3 lightDir;</span><br><span class="line">varying vec2 uv;</span><br><span class="line">varying vec3 norm;</span><br><span class="line"></span><br><span class="line">void diffuseShader()</span><br><span class="line">&#123;</span><br><span class="line">	vec3 kd;</span><br><span class="line">	kd = texture2d(myTexture, uv)</span><br><span class="line">	kd *= clamp(dot(-lightDir, norm), 0.0, 1.0);</span><br><span class="line">	gl_FragColor = vec4(kd, 1.0)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h1 id="Texture-Mapping"><a href="#Texture-Mapping" class="headerlink" title="Texture Mapping"></a>Texture Mapping</h1><p>1.如何定义物体的属性？</p>
<p>只研究物体表面，3维物体的表面是二维的</p>
<p>2.纹理映射到uv坐标系</p>
<h1 id="Barycentric-coordinates"><a href="#Barycentric-coordinates" class="headerlink" title="Barycentric coordinates"></a>Barycentric coordinates</h1><p>为什么需要插值？</p>
<p>将三角形顶点的性质平滑延拓到内部，比如Texture coordinates, colors, normal vectors, depth</p>
<p>差值方法是利用重心坐标对三个顶点的属性进行线性加权</p>
<p>重心坐标的问题：不能保证在投影下重心坐标的不变性，所以重心坐标只适合二维平面的差值而不适合三维空间。所以三维空间中的属性建议先在三维空间中做插值在映射到二维平面</p>
<h1 id="Applying-Texture"><a href="#Applying-Texture" class="headerlink" title="Applying Texture"></a>Applying Texture</h1><p>利用重心坐标可以计算得到采样点对应的纹理坐标，在uv空间得到颜色</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">for each rasterized screen sample(x,y):</span><br><span class="line">	(u,v) = evaluate texture coordinate at(x,y)</span><br><span class="line">	texcolor = texture.sample(u,v)</span><br><span class="line">	set sample&#x27;s color to texcolor</span><br></pre></td></tr></table></figure>

<p>过于简单出现问题：</p>
<ul>
<li><p>Texture Magnification.纹理太小，对应的纹理坐标不是整数。</p>
<p>A picel on a texture – a texel. </p>
<p>解决办法：</p>
<p>Nearest,将最邻近的整点texel的像素作为值，但是是一个一个的方块</p>
<p>Blinear interpolation,根据相邻四个texel的像素值在u方向与v方向进行线性插值。</p>
<p>Bicubic interpolation,取16个点</p>
</li>
<li><p>Texture Magnification.纹理太大，会带来走样的问题</p>
<p>屏幕上像素在纹理空间覆盖的区域大小不相同，覆盖大的区域的像素值如何获得？能直接用覆盖区域中心的texel的值吗？</p>
<p>解决方法：</p>
<p><strong>超采样</strong>：类似的MSAA，增加采样点的数目，对于屏幕上每个像素增加采样点数目，在纹理空间采样。</p>
<p><strong>或者不采样</strong>：计算纹理空间覆盖区域的平均值。但是如何获取覆盖区域？</p>
<p>Mipmap: Allowing(fast, approx, square)range queries</p>
<p>Mipmap由一张图生成很多图，做法类似于2X2的池化，降采样的概念同CV中的图像金字塔。</p>
<p>如何进行区域查询？对于屏幕上的一个像素，计算与相邻像素在纹理空间的距离，以距离的一半作为在纹理空间上覆盖区域的边长的一半。</p>
<p>如何利用Mipmap查询区域的像素值？D = log<sub>2</sub>L,寻找对应层上的像素。如果D不是整数怎么办？先利用双线性插值在相邻两层间插值出对应位置的像素值，再在层与层之间做一次插值。</p>
<p>但是MipMap的问题：出现Overblur,对于远处物体会模糊其细节。</p>
<p><strong>Anisotropic Filtering</strong>(各向异性滤波):部分解决三线性插值的问题。MipMap做长宽相同的图，Anisotropic Filtering做长宽不同的预计算。</p>
</li>
</ul>
<p>点查询问题与范围查询问题？平均范围与其他范围查询？</p>
<h1 id="Application-of-textures"><a href="#Application-of-textures" class="headerlink" title="Application of textures"></a>Application of textures</h1><p>Environment Map:</p>
<p>将四面八方的光记录下来就是Environment Map.</p>
<p>Spherical Map:</p>
<p>将环境光记录在球上再展开，但是存在问题：球面产生扭曲–&gt;&gt;cubic map，用立方体记录环境光</p>
<p>Bump Mapping 凹凸贴图：</p>
<p>存在问题：自己的阴影不会影响自己的shading</p>
<p>纹理记录深度信息(如相对深度)，会带来法线方向的改变，从而影响shading</p>
<ul>
<li>假设原本表面是一个平面，法线方向是(0,1)</li>
<li>运用凹凸贴图后，如何计算法线方向？dp = constant * [h(p+1)- h(p)]用差分的方法得到切线方向(1,dp)，最后利用切线方向得到法线方向(-dp, 1)</li>
<li>3D空间的发现：平面法线(0,0,1)，(u,v,p)–&gt;&gt;计算d<sub>p</sub>/d<sub>u</sub>与d<sub>p</sub>/d<sub>v</sub>,计算得到梯度，最后法线方向(-d<sub>p</sub>/d<sub>u</sub>, -d<sub>p</sub>/d<sub>v</sub>, 1)</li>
</ul>
<p>Displacement mapping:</p>
<p>移动顶点的位置，效果更好，但是要求模型的小三角形足够细。</p>
<p>3D Procedural Noise + Solid Modeling</p>
<p>3维纹理，用一个表达式定义一个三维噪声</p>
<p>Volume Rendering</p>
<p>记录三维信息</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/02/13/CG-Ray-tracing/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="chen cong">
      <meta itemprop="description" content="personal blog of cc">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="starC">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/02/13/CG-Ray-tracing/" class="post-title-link" itemprop="url">CG_Ray_tracing</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2022-02-13 10:29:04 / 修改时间：10:29:26" itemprop="dateCreated datePublished" datetime="2022-02-13T10:29:04+08:00">2022-02-13</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Ray-Tracing"><a href="#Ray-Tracing" class="headerlink" title="Ray Tracing"></a>Ray Tracing</h1><p>1.光栅化存在的问题:soft shadows, glossy reflection, Indirect illumination。</p>
<p>2.Basic ray racing</p>
<p>Three ideas about light rays；</p>
<ul>
<li>Light travels in straight lines</li>
<li>Light rays do not “collide” with each other if they cross</li>
<li>Light rays travel from the light sources to the eye(but the physics is invariant under path reversal )(光路可逆)</li>
</ul>
<p>3.Ray Casting</p>
<p>连接人眼与像素，连线与场景内物体相交(只与最近的相交，已经解决了深度测试的问题)，将交点与光源相连，看连线是否被遮挡，得知该点是否会被照亮/是否在阴影中</p>
<p>4.Recursive(Whitted-Style)Ray Tracing</p>
<p>连接人眼与像素，连线与场景内最近的物体相交得到交点，考虑在该交点处的无能量损失的反射，以及折射。每个反射点、折射点都与光源进行连线，计算每个点的色素值，最后都加到最开始的像素值(理解光路可逆的含义)。</p>
<p>考虑能量损失，区分shadow rays、secondary rays等等</p>
<p>技术问题：</p>
<p>Ray-Surface Intersection(求光线与物体表面的交点)：</p>
<p>Ray equation:<br>$$<br>r(t) = o + td<br>$$<br>o是光源起点，d是光线传播方向</p>
<p>Ray Intersection With Triangle:先光与平面求交，再判断交点是否在三角形内部</p>
<p>求交点的方程出处：平面法线与平面内任何一条线垂直</p>
<p>Moller Trumbore Algorithm可以直接写出方法是用重心坐标表示交点</p>
<p>如何加速ray tracing</p>
<p>Bounding Volumes:用框将物体包围，所以一条光线如何碰不到包围核，那就更碰不到核内物体。经常使用Axis-Aligned Bounding Box</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/02/13/CG-Geometry/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="chen cong">
      <meta itemprop="description" content="personal blog of cc">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="starC">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/02/13/CG-Geometry/" class="post-title-link" itemprop="url">CG_Geometry</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2022-02-13 10:26:49 / 修改时间：10:28:45" itemprop="dateCreated datePublished" datetime="2022-02-13T10:26:49+08:00">2022-02-13</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Geometry"><a href="#Geometry" class="headerlink" title="Geometry"></a>Geometry</h1><p>Implicit &amp; Explicity Geometry</p>
<p>是两种几何表述方法Implicit Geometry: Points satisfy specified reationship. x^2+y^2+Z^2=1</p>
<p>对于判断点在不在面上较为简单，但举出所有在免上的点，绘制出几何形体比较难</p>
<p>Explicit Geometry:  直接给出点的坐标或参数映射的方式给出点的坐标f: R<sup>2</sup>–&gt;&gt;R<sup>3</sup> ,(u,v)–&gt;&gt;(x,y,z)</p>
<p>有点和缺点与Implicit Geometry相反</p>
<p>Constructive Solid Geometry(Implicit)</p>
<p>利用布尔运算合并implicit geometry,根据简单几何形成复杂几何</p>
<p>Distance Functions(Implicit)</p>
<p>根据距离函数而不是布尔运算进行blend</p>
<p>Distance functions:定义一个点到目标物体上任意点的最小距离</p>
<p>Point cloud(Explicit)</p>
<p>Polygon Mesh(Explicit)</p>
<h1 id="Curves"><a href="#Curves" class="headerlink" title="Curves"></a>Curves</h1><p>1.Bezier Curve</p>
<p>de Casteljau Algorithm:生成贝塞尔曲线</p>
<p>用数学语言表述：Bernstein polynomial作为系数对给定点进行加权</p>
<p>仿射变换下只需要将给定点做仿射变换再生成贝塞尔曲线即可</p>
<p>贝塞尔曲线在控制点的凸包内</p>
<p>Piecewaise Bezier Curves,如何将贝塞尔曲线连续？</p>
<p>C<sup>0</sup>连续，端点相连</p>
<p>C<sup>1</sup>连续，端点相连，导数相同</p>
<p>2.B-splines</p>
<ul>
<li>short for base splines</li>
</ul>
<p>3.Bezier Surface</p>
<p>4 X 4 = 16个点</p>
<p>水平方向每四个点获取四条曲线，竖直方向根据曲线上四个点再拟合贝塞尔曲线</p>
<p>4.subdivision</p>
<p>细分图形，不仅是增加三角形的数目，还需要使物体看上去更圆滑</p>
<p>Loop subdivision:对不同的顶点应用不同的变换</p>
<p>new point = 1/8X(old points in the line) + 3/8 X (old points vertical perpendicular to the line)</p>
<p>old point = (1- n X u) X orginal_position + u*neighbor_position_sum</p>
<p>Catmull-Clark Subdivision(General Mesh)</p>
<p>物体可能不是用三角形描述的</p>
<p>首先定义quad face与Non-quad face，还有Extraordinary vertex(奇异点，度不为4)</p>
<p>取每条边的中点，取每个面的中点</p>
<p>第一次细分之后增加了非四边形面个奇异点个数，之后不会再增加奇异点个数</p>
<p>如何调整：将点分为三类：在平面中心的点、边中心的点、原始的顶点</p>
<p>Mesh Simplification</p>
<p>Goal:reduce number of mesh elements while maintaining the overall shape</p>
<p>做法：Collapsing An Edge(边坍缩)，将一条边的两个顶点变成一个点</p>
<p>但是哪些边需要进行坍缩？使用Quadric Error Metrics(二次误差度量)，将某个点放在某个位置上使其到其原本连接各个面的距离最小。</p>
<p>如何选边？先为每个边用二次误差度量打个分，每次选最小的边，更新受影响的边(建议使用堆结构)</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/01/22/%E9%87%8F%E5%8C%96%E7%AD%96%E7%95%A5%E6%A8%A1%E4%BB%BF/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="chen cong">
      <meta itemprop="description" content="personal blog of cc">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="starC">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/01/22/%E9%87%8F%E5%8C%96%E7%AD%96%E7%95%A5%E6%A8%A1%E4%BB%BF/" class="post-title-link" itemprop="url">量化策略模仿</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2022-01-22 17:07:53 / 修改时间：17:17:39" itemprop="dateCreated datePublished" datetime="2022-01-22T17:07:53+08:00">2022-01-22</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="一、小市值测量"><a href="#一、小市值测量" class="headerlink" title="一、小市值测量"></a>一、小市值测量</h1><p>0.前言</p>
<p>非常naive的想法，选取市值最低的20只股票，每次交易先平仓，再按比例平均买入这些股票</p>
<p>两种写法：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">start = &#x27;2013-01-01&#x27;                       # 回测起始时间</span><br><span class="line">end = &#x27;2014-01-01&#x27;                         # 回测结束时间</span><br><span class="line">universe = DynamicUniverse(&#x27;A&#x27;).apply_filter(Factor.LCAP.nsmall(20))  </span><br><span class="line">										   # 证券池，支持股票、基金、期货、指数四种资产</span><br><span class="line">benchmark = &#x27;HS300&#x27;                        # 策略参考标准</span><br><span class="line">freq = &#x27;d&#x27;                                 # 策略类型，&#x27;d&#x27;表示日间策略使用日线回测，&#x27;m&#x27;表示日内策略使用分钟线回测</span><br><span class="line">refresh_rate = Monthly(1)                         # 调仓频率，表示执行handle_data的时间间隔，若freq = &#x27;d&#x27;时间间隔的单位为交易日，若freq = &#x27;m&#x27;时间间隔为分钟</span><br><span class="line">  </span><br><span class="line"># 配置账户信息，支持多资产多账户</span><br><span class="line">accounts = &#123;</span><br><span class="line">    &#x27;fantasy_account&#x27;: AccountConfig(account_type=&#x27;security&#x27;, capital_base=10000000)</span><br><span class="line">&#125;</span><br><span class="line">  </span><br><span class="line">def initialize(context):</span><br><span class="line">    pass</span><br><span class="line">  </span><br><span class="line"># 每个单位时间(如果按天回测,则每天调用一次,如果按分钟,则每分钟调用一次)调用一次</span><br><span class="line">def handle_data(context):    </span><br><span class="line"></span><br><span class="line">    account = context.get_account(&#x27;fantasy_account&#x27;)</span><br><span class="line">    universe = context.get_universe(exclude_halt=False)</span><br><span class="line">    account.close_all_positions()</span><br><span class="line">    for stock in universe:</span><br><span class="line">        account.order_pct_to(stock,0.05)</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">start = &#x27;2013-01-01&#x27;                       # 回测起始时间</span><br><span class="line">end = &#x27;2014-01-01&#x27;                         # 回测结束时间</span><br><span class="line">universe = DynamicUniverse(&#x27;A&#x27;)       		# 证券池，支持股票、基金、期货、指数四种资产</span><br><span class="line">benchmark = &#x27;HS300&#x27;                        # 策略参考标准</span><br><span class="line">freq = &#x27;d&#x27;                                 # 策略类型，&#x27;d&#x27;表示日间策略使用日线回测，&#x27;m&#x27;表示日内策略使用分钟线回测</span><br><span class="line">refresh_rate = Monthly(1)                         # 调仓频率，表示执行handle_data的时间间隔，若freq = &#x27;d&#x27;时间间隔的单位为交易日，若freq = &#x27;m&#x27;时间间隔为分钟</span><br><span class="line">  </span><br><span class="line"># 配置账户信息，支持多资产多账户</span><br><span class="line">accounts = &#123;</span><br><span class="line">    &#x27;fantasy_account&#x27;: AccountConfig(account_type=&#x27;security&#x27;, capital_base=10000000)</span><br><span class="line">&#125;</span><br><span class="line">  </span><br><span class="line">def initialize(context):</span><br><span class="line">    pass</span><br><span class="line">  </span><br><span class="line"># 每个单位时间(如果按天回测,则每天调用一次,如果按分钟,则每分钟调用一次)调用一次</span><br><span class="line">def handle_data(context):    </span><br><span class="line">    account = context.get_account(&#x27;fantasy_account&#x27;)</span><br><span class="line">    universe = context.get_universe(exclude_halt=False)</span><br><span class="line">    </span><br><span class="line">    lcap_data = DataAPI.MktStockFactorsOneDayGet(context.previous_date,secID=universe,ticker=u&quot;&quot;,field=[&#x27;secID&#x27;,&#x27;LCAP&#x27;],pandas=&quot;1&quot;)</span><br><span class="line">    lcap_data.set_index(&#x27;secID&#x27;,inplace=True)</span><br><span class="line">    lcap_data.sort_values(by=&#x27;LCAP&#x27;,inplace=True)</span><br><span class="line">    </span><br><span class="line">    buy_list = lcap_data[:20].index</span><br><span class="line">    </span><br><span class="line">    account.close_all_positions()</span><br><span class="line">    for stock in buy_list:</span><br><span class="line">        account.order_pct_to(stock,0.05)</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/01/22/%E7%86%9F%E6%82%89Uquant%E5%B9%B3%E5%8F%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="chen cong">
      <meta itemprop="description" content="personal blog of cc">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="starC">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/01/22/%E7%86%9F%E6%82%89Uquant%E5%B9%B3%E5%8F%B0/" class="post-title-link" itemprop="url">熟悉Uquant平台</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2022-01-22 13:31:33 / 修改时间：17:08:29" itemprop="dateCreated datePublished" datetime="2022-01-22T13:31:33+08:00">2022-01-22</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="一、基本框架"><a href="#一、基本框架" class="headerlink" title="一、基本框架"></a>一、基本框架</h1><p>分为三个部分</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 第一部分：策略参数</span></span><br><span class="line">start = <span class="string">&#x27;2014-01-01&#x27;</span>                      <span class="comment"># 回测起始时间</span></span><br><span class="line">end = <span class="string">&#x27;2015-01-01&#x27;</span>                       <span class="comment"># 回测结束时间</span></span><br><span class="line">benchmark = <span class="string">&#x27;HS300&#x27;</span>                       <span class="comment"># 策略参考标准</span></span><br><span class="line">universe = [<span class="string">&#x27;000001.XSHE&#x27;</span>, <span class="string">&#x27;600000.XSHG&#x27;</span>]        <span class="comment"># 证券池，支持股票和基金</span></span><br><span class="line">capital_base = <span class="number">100000</span>                      <span class="comment"># 起始资金</span></span><br><span class="line">freq = <span class="string">&#x27;d&#x27;</span>                             <span class="comment"># 策略类型，&#x27;d&#x27;表示日间策略使用日线回测，&#x27;m&#x27;表示日内策略使用分钟线回测</span></span><br><span class="line">refresh_rate = <span class="number">1</span>                         <span class="comment"># 调仓频率，表示执行handle_data的时间间隔，若freq = &#x27;d&#x27;时间间隔的单位为交易日，若freq = &#x27;m&#x27;时间间隔为分钟</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 第二部分：初始化策略，回测期间只运行一次，可以用于设置全局变量</span></span><br><span class="line"><span class="comment"># account是回测期间的虚拟交易账户，存储上述全局变量参数信息，并在整个策略执行期间更新并维护可用现金、证券的头寸、每日交易指令明细、历史行情数据等。</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">initialize</span>(<span class="params">account</span>):</span> </span><br><span class="line">    <span class="comment"># account.i = 1</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 第三部分：策略每天下单逻辑，执行完成后，会输出每天的下单指令列表</span></span><br><span class="line"><span class="comment"># 这个函数在每个交易日开盘前被调用，模拟每个交易日开盘前，交易策略会根据历史数据或者其他信息进行交易判断，生成交易指令</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">handle_data</span>(<span class="params">account</span>):</span> </span><br><span class="line">    <span class="comment"># 这里编写下单逻辑</span></span><br><span class="line">    <span class="keyword">return</span></span><br></pre></td></tr></table></figure>

<h3 id="1-策略参数"><a href="#1-策略参数" class="headerlink" title="1.策略参数"></a>1.策略参数</h3><p>关于universe(证券池):下单与历史数据获取只能限于universe中的证券。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">universe = &#123;<span class="string">&#x27;600000.XSHG&#x27;</span>&#125;								<span class="comment">#某一支股票</span></span><br><span class="line">universe = set_universe(<span class="string">&#x27;HS300&#x27;</span>, data=<span class="string">&#x27;20220122&#x27;</span>)		<span class="comment">#沪深300的静态股票池</span></span><br><span class="line">universe = Dynamicuniverse(<span class="string">&#x27;HS300&#x27;</span>)						<span class="comment">#沪深300的动态股票池</span></span><br></pre></td></tr></table></figure>

<p>关于refreash_data:策略运行的时间，与freq一起使用</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">refresh_rate = n   	 <span class="comment">#表示n个freq运行一次策略</span></span><br><span class="line">refresh_rate = Weekly(<span class="number">1</span>)	<span class="comment">#每周第一天， Weekly(-1)每周最后一天，Monthly(1)每月第一天</span></span><br><span class="line"></span><br><span class="line">freq = <span class="string">&#x27;m&#x27;</span></span><br><span class="line">refreash_rate = (<span class="number">1</span>,<span class="number">1</span>)	<span class="comment">#前一个1表示每天运行，后一个表示每分钟运行一次</span></span><br></pre></td></tr></table></figure>

<p>关于max_history_window:数据获取的历史跨度</p>
<p>默认支持回溯100天数据，如果需要获取大于100天前的数据，需要指定。</p>
<h3 id="2-交易用户配置"><a href="#2-交易用户配置" class="headerlink" title="2.交易用户配置"></a>2.交易用户配置</h3><ul>
<li>使用字典完成账户创建，赋值给accounts</li>
<li>key为自定义用户名，value为使用AccountConfig类生成的账户实例</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#定义账户参数</span></span><br><span class="line">capital_base = <span class="number">100000</span>		<span class="comment">#初始资金</span></span><br><span class="line">commission = Commision(<span class="number">0.005</span>,<span class="number">0.0010</span>,unit=<span class="string">&#x27;perValue&#x27;</span>)	<span class="comment">#佣金，buycost=0.005,sellcost=0.01.,unit=perValue意味着以股价百分比收手续费</span></span><br><span class="line"></span><br><span class="line">slippage = Slippage(0002, unit=<span class="string">&#x27;perValue&#x27;</span>)	<span class="comment">#滑点标准设置</span></span><br><span class="line"></span><br><span class="line">position_base = &#123;<span class="string">&#x27;000001.XSHE&#x27;</span>:<span class="number">100</span>&#125;			<span class="comment">#初始持仓</span></span><br><span class="line">cost_base = &#123;<span class="string">&#x27;000001.XSHE&#x27;</span>: <span class="number">10.00</span>&#125;			<span class="comment">#初始持仓成本</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#进行账户配置</span></span><br><span class="line">accounts = &#123;<span class="string">&#x27;self_account&#x27;</span>: AccountConfig(account_type=<span class="string">&#x27;security&#x27;</span>, capital_base=captial_base,commission=commision,slippage=slippage,position_base=position_base,cost_base=cost_base)&#125;</span><br><span class="line"><span class="comment">#账户对象获取,用账户名获取</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">handle_data</span>(<span class="params">context</span>):</span></span><br><span class="line">	account = context.get.account(<span class="string">&#x27;self_accoutn&#x27;</span>)</span><br></pre></td></tr></table></figure>



<h1 id="二、重要API"><a href="#二、重要API" class="headerlink" title="二、重要API"></a>二、重要API</h1><h3 id="1-context-策略运行环境"><a href="#1-context-策略运行环境" class="headerlink" title="1.context(策略运行环境)"></a>1.context(策略运行环境)</h3><ul>
<li>表示测量有哪些环境，包含运行时间、行情等内容，还可以用于存储策略中生成的临时数据的存储</li>
<li>测量框架在启动时创建Context实例，并以参数形式传递给initialize(context)和handle_rate(context),用于测量调度</li>
<li>在回测时，context包含有哪些时间、回测参数、回测运行时数据等。模拟交易时，包含运行时间、模拟交易参数、实时运行数据等；</li>
</ul>
<p>context对象的实现和方法</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#属性</span></span><br><span class="line">context.now					<span class="comment">#测量运行时刻</span></span><br><span class="line">context.current_data</span><br><span class="line">context.current_minute</span><br><span class="line">context.previous</span><br><span class="line"><span class="comment">#方法</span></span><br><span class="line">context.current_price()		<span class="comment">#当前价格</span></span><br><span class="line"></span><br><span class="line">context.get_account()		<span class="comment">#获取账户类实例</span></span><br><span class="line">context.get_universe()		<span class="comment">#获得符合筛选条件的当天上市状态的资产池</span></span><br><span class="line">context.history()			<span class="comment">#获取时间序列</span></span><br></pre></td></tr></table></figure>

<p><strong>context.method</strong></p>
<ul>
<li><p>context.get_universe(asset_type,exclude_halt=False)获取符合条件的当天上市状态的资产池</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">#使用</span><br><span class="line">universe = context.get_universe()</span><br><span class="line"></span><br><span class="line">asset_type				#获取指定资产类型的universe</span><br><span class="line">	#参数范围</span><br><span class="line">	#&#x27;stock&#x27;:股票  		&#x27;exchange_fund&#x27;:场内基金列表</span><br><span class="line">	#&#x27;index&#x27;:指数成分股列表 &#x27;otc_fund&#x27;:场外基金列表</span><br><span class="line">    #&#x27;futures&#x27;:期货合约列表 &#x27;base_futures&#x27;:普通期货合约列表</span><br><span class="line">    #&#x27;continuous_futures&#x27;:连续期货合约列表</span><br><span class="line">exclude_halt = False	#去除资产池中的停盘股票，仅适用于股票</span><br></pre></td></tr></table></figure>

<p>返回的是股票列表（list）</p>
</li>
<li><p>context.history(symbol,attribute,time_range,freq=’1d’,style=’sat’,rtype=’frame’)获取K线、因子等时间序列数据</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#example；</span></span><br><span class="line">data = context.history([<span class="string">&#x27;600000.XSHG&#x27;</span>],<span class="string">&#x27;closePrice&#x27;</span>,<span class="number">10</span>,freq=<span class="string">&#x27;1d&#x27;</span>,rtype=<span class="string">&#x27;frame&#x27;</span>,style=<span class="string">&#x27;sat&#x27;</span>)</span><br><span class="line"><span class="comment">#参数说明</span></span><br><span class="line">symbol		<span class="comment">#需要获取的证券list，支持单个证券与证券list</span></span><br><span class="line">attribute	<span class="comment">#需要获取的属性，支持单个值或属性list</span></span><br><span class="line">		<span class="comment">#&#x27;openPrice&#x27;:前复权开盘开盘价	&#x27;highPrice&#x27;:前复权最高价</span></span><br><span class="line">		<span class="comment">#&#x27;lowPrice&#x27;:前复权最低价		  &#x27;close_price&#x27;:前复权收盘价</span></span><br><span class="line">		<span class="comment">#&#x27;preClosePrice&#x27;:前复权前收盘价  &#x27;turnoverVol&#x27;:前复权成交量</span></span><br><span class="line">		<span class="comment">#&#x27;turnoverValue&#x27;:前复权成交额	   &#x27;PE&#x27;,&#x27;PB&#x27;等优矿因子库因子</span></span><br><span class="line">time_range	 <span class="comment">#所需回溯的历史K线图条数，和freq属性相对应</span></span><br><span class="line">freq		 <span class="comment">#K线图周期，支持&#x27;1d&#x27;,&#x27;1m&#x27;,&#x27;5m&#x27;,&#x27;15m&#x27;,&#x27;30m&#x27;,&#x27;60m&#x27;等周期</span></span><br><span class="line">style		<span class="comment">#数据返回类型，可以选择&#x27;ast&#x27;,&#x27;sat&#x27;或&#x27;tas&#x27;三种</span></span><br><span class="line">			<span class="comment">#a:attribute,s:symbol,t:time</span></span><br><span class="line">rtype		<span class="comment">#返回值的数据类型，可以选择&#x27;frame&#x27;或&#x27;array&#x27;</span></span><br></pre></td></tr></table></figure>

<p>返回的是一个dict</p>
</li>
</ul>
<h3 id="2-StockAccount-账户"><a href="#2-StockAccount-账户" class="headerlink" title="2.StockAccount(账户)"></a>2.StockAccount(账户)</h3><ul>
<li><p>StockAccount表示交易账户，在参数初始化时创建</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#使用</span></span><br><span class="line">account = context.get_account(<span class="string">&#x27;self_account&#x27;</span>)	<span class="comment">#获取账户信息</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#account属性</span></span><br><span class="line">account.cash					<span class="comment">#当前账户可用资金</span></span><br><span class="line">account.porforlio_value			<span class="comment">#账户资产价值</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#account方法</span></span><br><span class="line">account.get_position()			<span class="comment">#获取账户指定资产的position实例</span></span><br><span class="line">account.get_positions()			<span class="comment">#获取所有资产的position实例</span></span><br><span class="line"></span><br><span class="line">account.order()					<span class="comment">#进行下单委托</span></span><br><span class="line">account.order_to()				<span class="comment">#通过下单，将某个股票的持仓调整到多少手</span></span><br><span class="line">account.order_pct()				<span class="comment">#根据账户总价值，按一定比例下单</span></span><br><span class="line">account.order_pct_to()			<span class="comment">#通过下单，将某个股票的持仓调整到持有总价值的一定比例</span></span><br><span class="line">account.close_all_position()	<span class="comment">#卖掉所有持仓</span></span><br></pre></td></tr></table></figure>

<p>下单实例：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> stock <span class="keyword">in</span> universe:</span><br><span class="line">	account.order(stock,<span class="number">100</span>)		<span class="comment">#买一手</span></span><br><span class="line">    account.orderto(stock,<span class="number">100</span>)		<span class="comment">#买到十手</span></span><br><span class="line">    account.order_pct(stock,<span class="number">0.1</span>)	<span class="comment">#买入总价值的0.1</span></span><br><span class="line">    account.order_pct_to(stock,<span class="number">0.1</span>)	<span class="comment">#买入股票到总价值的0.1	</span></span><br></pre></td></tr></table></figure></li>
</ul>
<p><strong>account.method</strong></p>
<ul>
<li><p>account.get_position(symbol)获取指定资产的持仓信息,没有持仓则返回None</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">position = account.get_position(&#x27;600000.XSHG&#x27;)</span><br></pre></td></tr></table></figure></li>
<li><p>account.get_positions(exclude_halt=False)获取所有持仓，返回字典,key为证券代码，value为position实例</p>
</li>
<li><p>account.order(symbol,amount,price=0,otype=’market’)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#symbol:需要交易的证券代码，包含后缀的字符串</span><br><span class="line">#amount:需要交易的证券代码为symbol的证券数量，正表示买入，负表示卖出</span><br><span class="line">#price:下限价单是的下单价格(仅日内策略可用)</span><br><span class="line">#otype:交易指令类型，可选&#x27;market&#x27;(市价单)和&#x27;limit&#x27;(限价单)(仅在日内交易时可用限价单)</span><br></pre></td></tr></table></figure></li>
<li><p>account.order_to(symbol,amount,price=0,otype=’market’)类似于order</p>
</li>
<li><p>account.order_pct(symbol,pct)当前总价值的percent</p>
</li>
<li><p>account.order_pct_to(symbol,pct)到当前总价值的percent</p>
</li>
</ul>
<h3 id="3-position"><a href="#3-position" class="headerlink" title="3.position"></a>3.position</h3><ul>
<li><p>属性</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">position.amount					#持仓数量</span><br><span class="line">position.available_amount		#可卖出的持仓数量</span><br><span class="line">position.profile				#持仓浮动盈亏（随市场价格实时变动）</span><br><span class="line">position.coast					#平均持仓成本</span><br><span class="line">position.value					#持仓市值（随市场价格实时变动）</span><br></pre></td></tr></table></figure></li>
</ul>
<h1 id="三、其他重要操作"><a href="#三、其他重要操作" class="headerlink" title="三、其他重要操作"></a>三、其他重要操作</h1><h3 id="1-优矿因子库-数据-优矿-datayes-com"><a href="#1-优矿因子库-数据-优矿-datayes-com" class="headerlink" title="1.优矿因子库(数据 - 优矿 (datayes.com))"></a>1.优矿因子库(<a target="_blank" rel="noopener" href="https://uqer.datayes.com/data/browse/126/126001/?page=1">数据 - 优矿 (datayes.com)</a>)</h3><h3 id="2-signal框架"><a href="#2-signal框架" class="headerlink" title="2.signal框架"></a>2.signal框架</h3>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      

      <div class="site-overview-wrap sidebar-panel">
        
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="chen cong"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">chen cong</p>
  <div class="site-description" itemprop="description">personal blog of cc</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">11</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">7</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



        <div id="music163player">
        <iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=280 height=86 src="//music.163.com/outchain/player?type=2&id=1459343252&auto=1&height=66"></iframe>
        </iframe>
      </div>
      </div>

      

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">陈聪</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>


  <script defer src="/lib/three/three.min.js"></script>
    <script defer src="/lib/three/three-waves.min.js"></script>
    <script defer src="/lib/three/canvas_lines.min.js"></script>


  















  

  

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>
</html>
